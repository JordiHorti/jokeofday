{"version":3,"file":"configuration.min.js","sources":["../src/configuration.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Premium configuration.\n *\n * @module      tiny_premium/configuration\n * @copyright   2023 David Woloszyn <david.woloszyn@moodle.com>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {\n    addToolbarButton,\n    addMenubarItem,\n    addToolbarSection,\n    addContextmenuItem\n} from 'editor_tiny/utils';\nimport {\n    getInitialPluginConfiguration,\n    getPluginOptionName\n} from 'editor_tiny/options';\n\nconst configureToolbar = (toolbar) => {\n    // Add premium toolbar sections to house all the plugins with no natural home.\n    toolbar = addToolbarSection(toolbar, 'premium_a', 'advanced', true);\n    toolbar = addToolbarSection(toolbar, 'premium_b', 'formatting', true);\n    return toolbar;\n};\n\nexport const configure = (instanceConfig, options) => {\n    // Get the namespaced options for Tiny Premium before they are officially initialised.\n    // Due to the timing the plugin options are available, we need to get at the options in this slightly unconventional way.\n    const pluginOptions = getInitialPluginConfiguration(options);\n    const enabledPremiumPlugins = pluginOptions[getPluginOptionName('tiny_premium/plugin', 'premiumplugins')].split(',');\n\n    let plugins = instanceConfig.plugins;\n    let menu = instanceConfig.menu;\n    let toolbar = configureToolbar(instanceConfig.toolbar);\n    let contextmenu = instanceConfig.contextmenu;\n    let pluginsettings = {};\n\n    // Advanced Table.\n    if (enabledPremiumPlugins.indexOf('advtable') !== -1) {\n        plugins += ` advtable`;\n        menu = addMenubarItem(menu, 'table', '| advtablerownumbering', 'advtablesort');\n    }\n    // Enhanced Image Editing.\n    if (enabledPremiumPlugins.indexOf('editimage') !== -1) {\n        plugins += ` editimage`;\n        toolbar = addToolbarButton(toolbar, 'content', 'editimage', 'tiny_media_image');\n        // Remove the duplicate image button from the quickbar toolbar by redefining the values without 'imageoptions'.\n        // eslint-disable-next-line camelcase\n        instanceConfig.editimage_toolbar = 'rotateleft rotateright flipv fliph editimage';\n    }\n    // Export.\n    if (enabledPremiumPlugins.indexOf('export') !== -1) {\n        plugins += ` export`;\n        menu = addMenubarItem(menu, 'tools', '| export');\n    }\n    // Page Embed.\n    if (enabledPremiumPlugins.indexOf('pageembed') !== -1) {\n        plugins += ` pageembed`;\n        toolbar = addToolbarButton(toolbar, 'content', 'pageembed', 'tiny_media_video');\n    }\n    // Advanced Typography.\n    if (enabledPremiumPlugins.indexOf('typography') !== -1) {\n        plugins += ` typography`;\n        toolbar = addToolbarButton(toolbar, 'premium_b', 'typography');\n    }\n    // Case Change.\n    if (enabledPremiumPlugins.indexOf('casechange') !== -1) {\n        plugins += ` casechange`;\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'casechange');\n    }\n    // Checklist.\n    if (enabledPremiumPlugins.indexOf('checklist') !== -1) {\n        plugins += ` checklist`;\n        toolbar = addToolbarButton(toolbar, 'lists', 'checklist');\n    }\n    // Spell Checker Pro.\n    if (enabledPremiumPlugins.indexOf('tinymcespellchecker') !== -1) {\n        plugins += ` tinymcespellchecker`;\n        menu = addMenubarItem(menu, 'tools', 'spellcheckdialog', 'spellcheckerlanguage');\n        contextmenu = addContextmenuItem(contextmenu, 'spellchecker');\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'spellcheckdialog');\n    }\n    // Spelling Autocorrect.\n    if (enabledPremiumPlugins.indexOf('autocorrect') !== -1) {\n        plugins += ` autocorrect`;\n        menu = addMenubarItem(menu, 'tools', '| autocorrect capitalization', 'spellcheckdialog');\n    }\n    // Permanent Pen.\n    if (enabledPremiumPlugins.indexOf('permanentpen') !== -1) {\n        plugins += ` permanentpen`;\n        menu = addMenubarItem(menu, 'format', '| permanentpen configurepermanentpen');\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'permanentpen');\n        contextmenu = addContextmenuItem(contextmenu, 'configurepermanentpen');\n    }\n    // Format Painter.\n    if (enabledPremiumPlugins.indexOf('formatpainter') !== -1) {\n        plugins += ` formatpainter`;\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'formatpainter');\n    }\n    // Link Checker.\n    if (enabledPremiumPlugins.indexOf('linkchecker') !== -1) {\n        plugins += ` linkchecker`;\n        contextmenu = addContextmenuItem(contextmenu, 'linkchecker');\n    }\n    // Table of Contents.\n    if (enabledPremiumPlugins.indexOf('tableofcontents') !== -1) {\n        plugins += ` tableofcontents`;\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'tableofcontents');\n    }\n    // MathML\n    if (enabledPremiumPlugins.indexOf('math') !== -1) {\n        plugins += ` math`;\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'math');\n        menu = addMenubarItem(menu, 'insert', 'math', 'tableofcontents');\n    }\n    // Footnotes.\n    if (enabledPremiumPlugins.indexOf('footnotes') !== -1) {\n        plugins += ` footnotes`;\n        toolbar = addToolbarButton(toolbar, 'premium_a', 'footnotes');\n        menu = addMenubarItem(menu, 'insert', 'footnotes', 'tableofcontents');\n    }\n    // Powerpaste.\n    if (enabledPremiumPlugins.indexOf('powerpaste') !== -1) {\n        plugins += ` powerpaste`;\n    }\n\n    return {\n        plugins,\n        toolbar,\n        menu,\n        contextmenu,\n        ...pluginsettings\n    };\n};\n"],"names":["_exports","configure","instanceConfig","options","enabledPremiumPlugins","getInitialPluginConfiguration","getPluginOptionName","split","plugins","menu","toolbar","addToolbarSection","configureToolbar","contextmenu","indexOf","addMenubarItem","addToolbarButton","editimage_toolbar","addContextmenuItem"],"mappings":"gNAqJEA,SAAAC,UA5GuBA,CAACC,eAAgBC,WAGtC,MACMC,uBADgB,EAAAC,SAA6BA,+BAACF,UACR,EAAAG,8BAAoB,sBAAuB,mBAAmBC,MAAM,KAEhH,IAAIC,QAAUN,eAAeM,QACzBC,KAAOP,eAAeO,KACtBC,QAfkBA,WAEtBA,SAAU,EAAAC,OAAAA,mBAAkBD,QAAS,YAAa,YAAY,IACpD,EAAAC,OAAAA,mBAAkBD,QAAS,YAAa,cAAc,IAYlDE,CAAiBV,eAAeQ,SAC1CG,YAAcX,eAAeW,YA4FjC,OAxFmD,IAA/CT,sBAAsBU,QAAQ,cAC9BN,SAAW,YACXC,MAAO,EAAAM,OAAAA,gBAAeN,KAAM,QAAS,yBAA0B,kBAGf,IAAhDL,sBAAsBU,QAAQ,eAC9BN,SAAW,aACXE,SAAU,EAAAM,OAAAA,kBAAiBN,QAAS,UAAW,YAAa,oBAG5DR,eAAee,kBAAoB,iDAGU,IAA7Cb,sBAAsBU,QAAQ,YAC9BN,SAAW,UACXC,MAAO,EAAAM,OAAcA,gBAACN,KAAM,QAAS,cAGW,IAAhDL,sBAAsBU,QAAQ,eAC9BN,SAAW,aACXE,SAAU,EAAAM,OAAAA,kBAAiBN,QAAS,UAAW,YAAa,sBAGX,IAAjDN,sBAAsBU,QAAQ,gBAC9BN,SAAW,cACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,gBAGA,IAAjDN,sBAAsBU,QAAQ,gBAC9BN,SAAW,cACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,gBAGD,IAAhDN,sBAAsBU,QAAQ,eAC9BN,SAAW,aACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,QAAS,eAGa,IAA1DN,sBAAsBU,QAAQ,yBAC9BN,SAAW,uBACXC,MAAO,EAAAM,OAAAA,gBAAeN,KAAM,QAAS,mBAAoB,wBACzDI,aAAc,EAAAK,OAAAA,oBAAmBL,YAAa,gBAC9CH,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,sBAGC,IAAlDN,sBAAsBU,QAAQ,iBAC9BN,SAAW,eACXC,MAAO,EAAAM,OAAAA,gBAAeN,KAAM,QAAS,+BAAgC,sBAGlB,IAAnDL,sBAAsBU,QAAQ,kBAC9BN,SAAW,gBACXC,MAAO,EAAAM,OAAcA,gBAACN,KAAM,SAAU,wCACtCC,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,gBACjDG,aAAc,EAAAK,OAAAA,oBAAmBL,YAAa,2BAGM,IAApDT,sBAAsBU,QAAQ,mBAC9BN,SAAW,iBACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,mBAGC,IAAlDN,sBAAsBU,QAAQ,iBAC9BN,SAAW,eACXK,aAAc,EAAAK,OAAAA,oBAAmBL,YAAa,iBAGQ,IAAtDT,sBAAsBU,QAAQ,qBAC9BN,SAAW,mBACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,qBAGN,IAA3CN,sBAAsBU,QAAQ,UAC9BN,SAAW,QACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,QACjDD,MAAO,EAAAM,OAAAA,gBAAeN,KAAM,SAAU,OAAQ,qBAGE,IAAhDL,sBAAsBU,QAAQ,eAC9BN,SAAW,aACXE,SAAU,EAAAM,OAAgBA,kBAACN,QAAS,YAAa,aACjDD,MAAO,EAAAM,OAAAA,gBAAeN,KAAM,SAAU,YAAa,qBAGF,IAAjDL,sBAAsBU,QAAQ,gBAC9BN,SAAW,eAGR,CACHA,gBACAE,gBACAD,UACAI,wBAEH,CACH"}