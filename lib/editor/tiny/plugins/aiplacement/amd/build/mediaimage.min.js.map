{"version":3,"file":"mediaimage.min.js","sources":["../src/mediaimage.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AI Modal for Tiny.\n *\n * @module      tiny_aiplacement/mediaimage\n * @copyright   2024 Matt Porritt <matt.porritt@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {getString} from 'core/str';\nimport MediaImage from 'tiny_media/image';\nimport Notification from 'core/notification';\nimport {prefetchStrings} from 'core/prefetch';\n\nprefetchStrings('core_ai', [\n    'contentwatermark',\n]);\n\nexport default class AiMediaImage extends MediaImage {\n    constructor(editor, url, alt) {\n        super(editor); // Call the parent class constructor\n        this.generatedImageUrl = url;\n        this.altText = alt;\n        getString('contentwatermark', 'core_ai').then((watermark) => {\n            this.watermark = watermark;\n            return;\n        }).catch(Notification.exception);\n    }\n\n    getSelectedImage() {\n        const imgElement = document.createElement('img');\n\n        // Set attributes for the img element\n        imgElement.src = this.generatedImageUrl;\n        imgElement.alt = this.truncateAltText(this.altText);\n\n        return imgElement;\n    }\n\n    /**\n     * Truncate the alt text if it is longer than the maximum length.\n     * @param {String} altText The alt text\n     * @return {string} The truncated alt text\n     */\n    truncateAltText(altText) {\n        const maximumAltTextLength = 125;\n        const watermark = ' - ' + this.watermark;\n        const ellipsis = '...';\n\n        // Append the watermark to the alt text.\n        if (altText.length + watermark.length <= maximumAltTextLength) {\n            altText = altText + watermark;\n        } else {\n            const remainingLength = maximumAltTextLength - watermark.length - ellipsis.length;\n            altText = altText.substring(0, remainingLength) + ellipsis + watermark;\n        }\n        return altText;\n    }\n}\n"],"names":["_interopRequireDefault","e","__esModule","default","_image","_notification","prefetchStrings","AiMediaImage","MediaImage","constructor","editor","url","alt","super","this","generatedImageUrl","altText","getString","then","watermark","catch","Notification","exception","getSelectedImage","imgElement","document","createElement","src","truncateAltText","length","remainingLength","ellipsis","substring","_exports"],"mappings":"2KAyB6C,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA;;;;;;;qFAD7CG,OAAAJ,uBAAAI,QACAC,cAAAL,uBAAAK,gBAGA,EAAAC,2BAAgB,UAAW,CACvB,qBAGW,MAAMC,qBAAqBC,OAAAA,QACtCC,WAAAA,CAAYC,OAAQC,IAAKC,KACrBC,MAAMH,QACNI,KAAKC,kBAAoBJ,IACzBG,KAAKE,QAAUJ,KACf,EAAAK,KAAAA,WAAU,mBAAoB,WAAWC,MAAMC,YAC3CL,KAAKK,UAAYA,SACjB,IACDC,MAAMC,cAAYlB,QAACmB,UAC1B,CAEAC,gBAAAA,GACI,MAAMC,WAAaC,SAASC,cAAc,OAM1C,OAHAF,WAAWG,IAAMb,KAAKC,kBACtBS,WAAWZ,IAAME,KAAKc,gBAAgBd,KAAKE,SAEpCQ,UACX,CAOAI,eAAAA,CAAgBZ,SACZ,MACMG,UAAY,MAAQL,KAAKK,UAI/B,GAAIH,QAAQa,OAASV,UAAUU,QALF,IAMzBb,SAAoBG,cACjB,CACH,MAAMW,gBARmB,IAQsBX,UAAUU,OAASE,EAClEf,QAAUA,QAAQgB,UAAU,EAAGF,iBAPlB,MAOgDX,SACjE,CACA,OAAOH,OACX,EACH,OAAAiB,SAAA9B,QAAAI,aAAA0B,SAAA9B,OAAA"}